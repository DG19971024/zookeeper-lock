## zookeeper-lock

### 利用Zookeeper实现分布式锁
使用该分布式锁，去简单的模拟一个秒杀场景下的减商品库存

利用的两个Zookeeper特性：

（1）临时有序节点：保证了即使客户端发生异常没有删除节点，该节点也会自动被删除。而且有序节点可以将所有操作变成串行操作。

（2）事件监听与回调机制：Zookeeper客户端与服务端实现了事件监听与回调，该机制非常重要，他可以保证服务端的节点发生改变时，客户端可以感知并作出相应的动作。

实现锁的思路原理

（1）以节点序号判断是否获取到锁，每个线程在创建锁时，都会在Zookeeper服务端创建一个临时有序节点，依据Zookeeper有序节点的性质，
每一个节点的序号都是有序依次递增，所以，我们每创建一个节点，都可以监控前一个序号的节点是否被删除（还有种情况，就是监控时该节点已经删除了，也就是节点不存在），
如果已被删除那么就表示当前节点是头节点，可以获取锁，如果没有被删除，则表示不能获取锁

（2）临时有序节点，临时节点可以保证及时客户端由于某种原因没有释放锁（删除节点），服务端也会自动的删除该节点，可以避免死锁

（3）如果当前线程没有获取到锁，则需要进入阻塞或者超时阻塞状态，可以通过JDK自带的一些线程同步类实现，比如通过CountDownLatch

（4）获取到锁后（也即是监听到前一个节点被删除的时间、或者判断到该节点已经不存在了），通过Watcher机制，解除主线程的阻塞，获取到锁。